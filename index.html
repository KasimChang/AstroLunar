<!DOCTYPE html>
<html lang="zh-Hant" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstroLunar Pro - 農曆計算工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <!-- 導入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .term-card {
            transition: transform 0.2s ease, background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .term-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
        }
        .spring { border-left-width: 5px; border-left-color: #10b981; }
        .summer { border-left-width: 5px; border-left-color: #ef4444; } 
        .autumn { border-left-width: 5px; border-left-color: #d97706; }
        .winter { border-left-width: 5px; border-left-color: #3b82f6; }
        
        /* 強化轉換工具陰影與對比 */
        .converter-shadow {
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.15), 0 8px 10px -6px rgba(79, 70, 229, 0.05);
        }
        .dark .converter-shadow {
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.6);
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* 讓日曆 Icon 在深色模式下變成白色 */
        .dark input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-950 text-slate-900 dark:text-slate-100 p-4 md:p-8 min-h-screen flex flex-col transition-all duration-500">

    <div class="max-w-5xl mx-auto flex-grow w-full">
        <!-- Header with Branding & Theme Toggle -->
        <header class="flex justify-between items-start mb-12">
            <!-- Top Left: Branding (Inspired by ProfitFlowPro) -->
            <div class="flex items-center gap-3">
                <div class="p-2 bg-indigo-600 rounded-xl text-white shadow-lg shadow-indigo-500/20">
                    <i data-lucide="orbit" class="w-6 h-6"></i>
                </div>
                <div class="flex flex-col">
                    <div class="flex items-center leading-none">
                        <span class="text-2xl font-[900] tracking-tighter text-slate-900 dark:text-white">AstroLunar</span>
                        <span class="text-2xl font-light tracking-tighter text-indigo-500 ml-0.5">Pro</span>
                    </div>
                    <span class="text-[9px] uppercase font-black tracking-[0.3em] text-slate-400 dark:text-slate-500 mt-1">Precision Dynamics</span>
                </div>
            </div>

            <!-- Top Right: Toggle -->
            <button id="themeToggle" class="p-3 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm hover:scale-110 transition-all shrink-0">
                <i data-lucide="sun" class="w-5 h-5 block dark:hidden text-amber-500"></i>
                <i data-lucide="moon" class="w-5 h-5 hidden dark:block text-blue-400"></i>
            </button>
        </header>

        <!-- Main Content Title -->
        <div class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-black text-slate-900 dark:text-white tracking-tight">農曆計算工具</h1>
        </div>

        <!-- Tool 1: Solar to Lunar -->
        <section class="mb-12">
            <div class="bg-white dark:bg-slate-900 rounded-3xl converter-shadow p-6 md:p-8 border border-slate-200 dark:border-slate-800 transition-colors">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center gap-3 text-slate-800 dark:text-slate-100">
                        <div class="w-2.5 h-8 bg-indigo-600 rounded-full"></div>
                        <h2 class="text-2xl font-black tracking-tight">公曆 / 農曆 互換查詢</h2>
                    </div>
                    <button id="todayBtn" class="text-xs font-black px-5 py-2 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-full hover:bg-indigo-600 hover:text-white dark:hover:bg-indigo-600 dark:hover:text-white transition-all border border-slate-200 dark:border-slate-700 uppercase tracking-widest shadow-sm">今天</button>
                </div>
                
                <div class="space-y-6">
                    <!-- Two Column Input -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase tracking-[0.2em]">選擇西洋曆日期</label>
                            <input type="date" id="dateInput" 
                                class="w-full border-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-2xl px-5 py-4 focus:border-indigo-500 dark:focus:border-indigo-400 focus:bg-white dark:focus:bg-slate-900 outline-none text-xl transition-all shadow-sm text-slate-800 dark:text-white font-bold">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase tracking-[0.2em]">對應民國年份</label>
                            <div class="w-full border-2 border-slate-200 dark:border-slate-700 bg-indigo-50 dark:bg-slate-800/50 rounded-2xl px-5 py-4 flex items-center justify-between">
                                <span id="rocYearDisplay" class="text-xl font-black text-indigo-700 dark:text-indigo-300 tracking-tight">----</span>
                                <span class="text-[10px] bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 px-3 py-1 rounded-full font-black uppercase tracking-[0.2em]">ROC</span>
                            </div>
                        </div>
                    </div>

                    <!-- Result Display -->
                    <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 dark:from-indigo-700 dark:to-indigo-900 rounded-3xl p-8 text-white shadow-xl flex flex-col md:flex-row items-center justify-between gap-6 border border-white/10">
                        <div class="text-center md:text-left">
                            <span class="text-indigo-200 text-xs font-black opacity-70 block mb-2 uppercase tracking-[0.3em]">農曆轉換結果</span>
                            <div id="lunarResultDisplay" class="text-2xl md:text-4xl font-black tracking-tight leading-none">計算中...</div>
                        </div>
                        <div id="liChunInfo" class="text-xs font-black text-white bg-white/10 backdrop-blur-md border border-white/20 px-5 py-2 rounded-full whitespace-nowrap tracking-wide">
                            當年立春：--月--日
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tool 2: Solar Terms -->
        <section class="mb-12">
            <div class="bg-white dark:bg-slate-900 rounded-3xl shadow-lg p-6 md:p-10 border border-slate-200 dark:border-slate-800 transition-colors">
                <div class="flex items-center gap-3 mb-10 text-slate-800 dark:text-slate-100">
                    <div class="w-2.5 h-8 bg-emerald-500 rounded-full"></div>
                    <h2 class="text-2xl font-black tracking-tight">二十四節氣年度查詢</h2>
                </div>

                <!-- Year Inputs -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-8 mb-10 overflow-hidden">
                    <div class="flex flex-row flex-nowrap items-center gap-4 md:gap-8 w-full md:w-auto overflow-x-auto pb-2 md:pb-0">
                        <div class="flex items-center gap-3 whitespace-nowrap shrink-0">
                            <label class="text-slate-400 dark:text-slate-500 font-bold text-[10px] uppercase tracking-widest leading-none">西元</label>
                            <input type="number" id="ceYearInput" value="2025" min="1912" max="2100" 
                                class="border-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-2xl px-4 py-3 focus:border-emerald-500 dark:focus:border-emerald-400 outline-none text-2xl w-28 text-center font-black dark:text-white shadow-sm transition-all">
                        </div>
                        <div class="h-10 w-px bg-slate-200 dark:bg-slate-800 shrink-0"></div>
                        <div class="flex items-center gap-3 whitespace-nowrap shrink-0">
                            <label class="text-slate-400 dark:text-slate-500 font-bold text-[10px] uppercase tracking-widest leading-none">民國</label>
                            <input type="number" id="rocYearInput" value="114" min="1" max="189" 
                                class="border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-2xl px-4 py-3 focus:border-emerald-500 dark:focus:border-emerald-400 outline-none text-2xl w-24 text-center font-black dark:text-white shadow-sm transition-all">
                        </div>
                    </div>
                    <div class="text-[9px] md:text-[10px] font-black text-slate-400 dark:text-slate-500 bg-slate-100 dark:bg-slate-800/80 px-5 py-2.5 rounded-full border border-slate-200 dark:border-slate-700 uppercase tracking-[0.3em] shadow-inner shrink-0 self-end md:self-center">
                        節氣查詢範圍 1912-2100
                    </div>
                </div>

                <!-- Term Category Subtitles -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4 text-center px-2">
                    <div class="text-[11px] font-black text-slate-400 dark:text-slate-600 uppercase tracking-[0.4em]">節</div>
                    <div class="text-[11px] font-black text-slate-400 dark:text-slate-600 uppercase tracking-[0.4em]">氣</div>
                    <div class="hidden lg:block text-[11px] font-black text-slate-400 dark:text-slate-600 uppercase tracking-[0.4em]">節</div>
                    <div class="hidden lg:block text-[11px] font-black text-slate-400 dark:text-slate-600 uppercase tracking-[0.4em]">氣</div>
                </div>

                <!-- Results Grid -->
                <div id="resultsGrid" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                    <!-- JS will inject cards here -->
                </div>
            </div>
        </section>
    </div>

    <!-- Footer: 根據 Footer設計規範 -->
    <footer id="mainFooter" class="py-6 sm:py-8 border-t mt-auto transition-colors duration-300 bg-white border-slate-200 text-slate-500 dark:bg-slate-900/50 dark:border-slate-800 dark:text-slate-400">
        <div class="max-w-[1650px] mx-auto px-4 sm:px-8 flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">
            <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8">
                <a href="https://github.com/kasimchang" target="_blank" class="group flex items-center gap-3">
                    <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-full group-hover:bg-blue-500 group-hover:text-white transition-all">
                        <i data-lucide="github" class="w-4 h-4"></i>
                    </div>
                    <div class="flex flex-col text-left">
                        <span class="text-[10px] uppercase font-black tracking-widest opacity-60">Created by</span>
                        <span class="text-sm font-bold tracking-tight dark:text-slate-200">kasimchang</span>
                    </div>
                </a>
                <div class="hidden md:block h-8 w-px bg-slate-200 dark:bg-slate-800"></div>
                <div class="flex flex-col text-left">
                    <span class="text-[10px] uppercase font-black tracking-widest opacity-60">Copyright</span>
                    <span class="text-sm font-bold tracking-tight italic dark:text-slate-200">© 2026 農曆計算工具 Pro</span>
                </div>
            </div>
            <div class="flex flex-col md:items-end">
                <span class="text-[10px] uppercase font-black tracking-[0.3em] text-blue-500/80 mb-1 leading-none">Precision Astronomy</span>
                <p class="text-[11px] font-medium opacity-60">專為曆法與節氣設計的精密換算引擎</p>
            </div>
        </div>
    </footer>

    <script>
        // 初始化 Lucide Icons
        lucide.createIcons();

        // --- 主題切換邏輯 ---
        const html = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            html.classList.remove('dark');
        } else {
            html.classList.add('dark');
        }

        themeToggle.addEventListener('click', () => {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            const currentYear = parseInt(document.getElementById('ceYearInput').value);
            renderTerms(currentYear);
        });

        // --- 核心變數 ---
        const ANIMALS = ["鼠", "牛", "虎", "兔", "龍", "蛇", "馬", "羊", "猴", "雞", "狗", "豬"];
        const STEMS = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
        const BRANCHES = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];

        function getLiChunDate(year) {
            const y = year % 100;
            const d = Math.floor((y * 0.2422 + 3.87) - Math.floor((y - 1) / 4));
            return new Date(year, 1, d); 
        }

        // --- 工具 1: 公曆轉農曆 ---
        const dateInput = document.getElementById('dateInput');
        const rocYearDisp = document.getElementById('rocYearDisplay');
        const lunarResultDisplay = document.getElementById('lunarResultDisplay');
        const liChunInfo = document.getElementById('liChunInfo');
        const todayBtn = document.getElementById('todayBtn');

        function updateSolarToLunar() {
            const dateStr = dateInput.value;
            if (!dateStr) return;
            const [y, m, d] = dateStr.split('-').map(v => parseInt(v));
            const date = new Date(y, m - 1, d);
            if (isNaN(date)) return;

            const ceYear = date.getFullYear();
            rocYearDisp.innerText = `民國 ${ceYear - 1911} 年`;

            const formatter = new Intl.DateTimeFormat('zh-u-ca-chinese', { month: 'long', day: 'numeric' });
            const parts = formatter.formatToParts(date);
            let monthStr = "", dayStr = "";
            parts.forEach(p => {
                if (p.type === 'month') monthStr = p.value;
                if (p.type === 'day') dayStr = p.value;
            });

            const liChun = getLiChunDate(ceYear);
            const lcMonth = liChun.getMonth() + 1;
            const lcDay = liChun.getDate();
            liChunInfo.innerText = `當年立春：${lcMonth}月${lcDay}日`;

            const astroYear = date < liChun ? ceYear - 1 : ceYear;
            const stemIdx = ((astroYear - 4) % 10 + 10) % 10;
            const branchIdx = ((astroYear - 4) % 12 + 12) % 12;
            const yearLabel = `${STEMS[stemIdx]}${BRANCHES[branchIdx]}${ANIMALS[branchIdx]}年`;
            
            lunarResultDisplay.innerText = `${yearLabel} · ${monthStr} ${dayStr} 日`;
        }

        todayBtn.addEventListener('click', () => {
            const today = new Date();
            dateInput.value = today.toISOString().split('T')[0];
            updateSolarToLunar();
        });

        // --- 工具 2: 節氣查詢 ---
        const ceInput = document.getElementById('ceYearInput');
        const rocInput = document.getElementById('rocYearInput');
        const resultsGrid = document.getElementById('resultsGrid');

        const SOLAR_TERMS = [
            { name: "小寒", c: 5.4055, month: 1, season: 'winter' },
            { name: "大寒", c: 20.12, month: 1, season: 'winter' },
            { name: "立春", c: 3.87, month: 2, season: 'spring' },
            { name: "雨水", c: 18.73, month: 2, season: 'spring' },
            { name: "驚蟄", c: 5.63, month: 3, season: 'spring' },
            { name: "春分", c: 20.646, month: 3, season: 'spring' },
            { name: "清明", c: 4.81, month: 4, season: 'spring' },
            { name: "穀雨", c: 20.1, month: 4, season: 'spring' },
            { name: "立夏", c: 5.52, month: 5, season: 'summer' },
            { name: "小滿", c: 21.04, month: 5, season: 'summer' },
            { name: "芒種", c: 5.678, month: 6, season: 'summer' },
            { name: "夏至", c: 21.37, month: 6, season: 'summer' },
            { name: "小暑", c: 7.108, month: 7, season: 'summer' },
            { name: "大暑", c: 22.83, month: 7, season: 'summer' },
            { name: "立秋", c: 7.5, month: 8, season: 'autumn' },
            { name: "處暑", c: 23.13, month: 8, season: 'autumn' },
            { name: "白露", c: 7.646, month: 9, season: 'autumn' },
            { name: "秋分", c: 23.042, month: 9, season: 'autumn' },
            { name: "寒露", c: 8.318, month: 10, season: 'autumn' },
            { name: "霜降", c: 23.438, month: 10, season: 'autumn' },
            { name: "立冬", c: 7.438, month: 11, season: 'winter' },
            { name: "小雪", c: 22.36, month: 11, season: 'winter' },
            { name: "大雪", c: 7.18, month: 12, season: 'winter' },
            { name: "冬至", c: 21.94, month: 12, season: 'winter' }
        ];

        function renderTerms(year) {
            if (isNaN(year) || year < 1900 || year > 2100) return;
            const y = year % 100;
            resultsGrid.innerHTML = '';
            SOLAR_TERMS.forEach((term, index) => {
                let d = (y * 0.2422 + term.c) - Math.floor((y - 1) / 4);
                if (term.name === "春分" && year === 2084) d += 1;
                const day = Math.floor(d);
                const totalMinutes = Math.floor((d - day) * 24 * 60);
                const card = document.createElement('div');
                card.className = `term-card bg-white dark:bg-slate-900 p-5 md:p-6 rounded-3xl shadow-md border border-slate-200 dark:border-slate-800 ${term.season}`;
                const timeStr = `${String(Math.floor(totalMinutes/60)).padStart(2,'0')}:${String(totalMinutes%60).padStart(2,'0')}`;
                
                const typeLabel = (index % 2 === 0) ? '節' : '氣';
                const isDark = document.documentElement.classList.contains('dark');
                const badgeClass = getSeasonBadgeClass(term.season, isDark);
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-[clamp(0.6rem,2vw,0.75rem)] font-black px-3 py-1 rounded-full uppercase tracking-widest shadow-sm ${badgeClass}">
                            ${getSeasonName(term.season)} · ${typeLabel}
                        </span>
                        <span class="text-slate-400 dark:text-slate-600 font-black font-mono text-[clamp(0.6rem,2vw,0.75rem)]">${term.month}月</span>
                    </div>
                    <div class="flex justify-between items-center gap-3">
                        <div class="space-y-1 overflow-hidden shrink-0">
                            <h3 class="text-[clamp(1.1rem,3.5vw,1.5rem)] font-black text-slate-800 dark:text-slate-100 leading-none tracking-tight">${term.name}</h3>
                            <p class="text-indigo-600 dark:text-indigo-400 font-black text-[clamp(0.85rem,2.5vw,1rem)] whitespace-nowrap">
                                <span class="opacity-40 font-bold mr-1 text-[clamp(0.6rem,2vw,0.85rem)]">${year}</span>${term.month}/${day}
                            </p>
                        </div>
                        <div class="text-right flex flex-col items-end">
                            <p class="text-[clamp(1.5rem,5vw,2.25rem)] font-black text-slate-700 dark:text-white font-mono tracking-tighter leading-none">${timeStr}</p>
                            <p class="text-[clamp(0.6rem,1.5vw,0.7rem)] text-slate-400 dark:text-slate-500 uppercase font-black tracking-[0.2em] mt-1 italic">預期</p>
                        </div>
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
        }

        function getSeasonBadgeClass(s, isDark) {
            const map = {
                spring: isDark ? 'bg-emerald-900/60 text-emerald-400 border border-emerald-500/30' : 'bg-emerald-50 text-emerald-700 border border-emerald-200',
                summer: isDark ? 'bg-red-900/60 text-red-400 border border-red-500/30' : 'bg-red-50 text-red-700 border border-red-200',
                autumn: isDark ? 'bg-orange-900/60 text-orange-400 border border-orange-500/30' : 'bg-orange-50 text-orange-700 border border-orange-200',
                winter: isDark ? 'bg-blue-900/60 text-blue-400 border border-blue-500/30' : 'bg-blue-50 text-blue-700 border border-blue-200'
            };
            return map[s];
        }
        
        function getSeasonName(s) { const map = { spring: '春', summer: '夏', autumn: '秋', winter: '冬' }; return map[s]; }

        // --- 事件監聽 ---
        dateInput.addEventListener('change', updateSolarToLunar);
        
        ceInput.addEventListener('input', () => {
            const v = parseInt(ceInput.value);
            if (v >= 1912) rocInput.value = v - 1911;
            renderTerms(v);
        });
        rocInput.addEventListener('input', () => {
            const v = parseInt(rocInput.value) + 1911;
            ceInput.value = v;
            renderTerms(v);
        });

        // 初始執行
        const now = new Date();
        dateInput.value = now.toISOString().split('T')[0];
        updateSolarToLunar();
        renderTerms(2025);
    </script>
</body>
</html>